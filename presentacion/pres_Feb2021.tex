\documentclass[10pt, aspectratio=169]{beamer}

\usetheme[numbering=fraction, progressbar=foot]{metropolis}
\usepackage{appendixnumberbeamer}

\usepackage{booktabs}
\usepackage[scale=2]{ccicons}

\usepackage{pgfplots}
\usepgfplotslibrary{dateplot}

\usepackage{xspace}
\newcommand{\themename}{\textbf{\textsc{metropolis}}\xspace}

\usepackage{hyperref}
\usepackage{multirow}
\usepackage{bbm}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{calc}

\newcommand{\semitransp}[2][35]{\color{fg!#1}#2}
\newcommand{\hltext}[2]{\colorbox{#1}{\textcolor{white}{\textbf{#2}}}}

\title{\textcolor{UltraViolet} {\huge Agrupamiento de datos}}
\subtitle{Clustering}
\date{Febrero 2021}
\author{Diana L. Giraldo}
% \vspace{1cm}
% \institute{\hfill\includegraphics[height=1cm]{imgs/R-Ladies_LogoWithText_Horizontal.png}}

\begin{document}

\maketitle

\begin{frame}{}
  \setbeamertemplate{section in toc}[sections numbered]
  \tableofcontents[hideallsubsections]
\end{frame}


\section{Intro}

\definecolor{bdback}{RGB}{235,235,225}
{
\setbeamercolor{background canvas}{bg=bdback}
\begin{frame}[fragile]{}
\vspace{0.4cm}
\begin{columns}
\column{0.45\textwidth}
\alert{\textbf{\Large{¿Qué hago?}}}\\
\vspace{0.4cm}
\begin{center}
 En mi tesis de doctorado trabajo con información de:
\begin{itemize}
 \item Neuroimágenes
 \item Variables clínicas
 \item Evaluación neuropsicológica
\end{itemize}
para la caracterización de patrones asociados a la\\
\vspace{0.3cm}
\textcolor{BlueMoon}{\textbf{\Large enfermedad de Alzheimer,}}\\
\vspace{0.1cm}
la causa más común de \textbf{demencia}.
\end{center}
\column{0.55\textwidth}
\begin{figure}
\includegraphics[width=1\textwidth]{../../Documents/proposal-defense/img/brain_disease_wobkg.png}
\end{figure}
\end{columns} 
\end{frame}
}

\begin{frame}[fragile]{}
\begin{overlayarea}{\textwidth}{9cm}
\vspace{0.5cm}
\begin{columns}
 \column{0.5\textwidth}
  \vspace{0.1cm}
  \includegraphics[width=\textwidth]{../../Documents/proposal-defense/img/psytest.png}
 \column{0.5\textwidth}
 \begin{center}
  Antes de la demencia, cuando los pacientes muestran alguna disfunción cognitiva, se diagnostica el\\ 
 \vspace{0.3cm}
 \textcolor{BlueMoon}{\textbf{\Large Deterioro Cognitivo Leve}}\\
 Mild cognitive impairment (MCI).\\
 \vspace{0.3cm}
 Un conjunto de tests neurpsicológicos evalúan las funciones cognitivas en diferentes dominios: memoria, lenguaje, habilidades visuo-espaciales, etc.
 \end{center}
\end{columns}
\end{overlayarea}
\end{frame}

{%
\setbeamertemplate{frame footer}{$^*$ \textit{aka,} cacharrear con datos.}
\begin{frame}[fragile]{¿qué vamos a hacer hoy?}
 Usar$^*$ puntajes por dominio cognitivo para explorar la existencia de distintos \textbf{sub-grupos} de pacientes con Deterioro Cognitivo Leve.\\
 \vspace{0.2cm}
 \pause
 Los datos de prueba, código y esta presentación están en\\ \hltext{PinkPeacock}{\url{https://github.com/diagiraldo/RLadies_bta_2021/}}\\
 \vspace{0.4cm}
 \pause
 En RStudio:\\
 \vspace{-0.2cm}
 \begin{verbatim}
  A <- read.csv("datos/neuropsycho_data.csv")
  head(A)
 \end{verbatim}
 \vspace{-0.6cm}
 \begin{figure}
  \includegraphics[width=\textwidth]{imgs/head_datos.png}
 \end{figure}
\end{frame}
}

\begin{frame}[fragile]{Variables}
 \begin{columns}[T]
  \column{0.3\textwidth}
  \textcolor{PinkPeacock}{\textbf{Puntajes ESTANDARIZADOS por dominio:}}
  \begin{itemize}
   \item MEMORY
   \item LANGUAGE
   \item EXECUTIVE
   \item VISUOSPATIAL
   \item ORIENTATION
   \item ATTENTION
  \end{itemize}
  \column{0.6\textwidth}
  \textcolor{BlueMoon}{\textbf{Información demográfica:}}
  \begin{itemize}
   \item edad
   \item género
   \item edu: años de educación.
  \end{itemize}
  \textcolor{SparklingGrape}{\textbf{Información clínica:}}
  \begin{itemize}
   \item dx: diagnóstico
   \begin{itemize}
    \item CN: control
    \item MCI: deterioro cognitivo leve
   \end{itemize}
   \item progresion: diagnóstico de demencia en futuras visitas?
   \item t\_progresión: meses entre visita y progresión.
   \item t\_seguimiento: meses de seguimiento a la persona.
  \end{itemize}
 \end{columns}
\end{frame}

\begin{frame}[fragile]{}
 Nos interesan los \textbf{puntajes por dominio} de \textbf{pacientes con Deterioro Cognitivo Leve.}\\
 \vspace{0.4cm}
 \pause
 En RStudio:\\
 \vspace{0.3cm}
 \begin{columns}[t]
 \column{0.03\textwidth}
 \pause
 \column{0.28\textwidth}
 \textcolor{UltraViolet}{\textbf{Cargar librerías:}}\\
 \vspace{-0.2cm}
 \begin{verbatim}
library(dplyr)
library(reshape2)
library(ggplot2)
library(cluster)
library(factoextra)
library(NbClust)
 \end{verbatim}
 \pause
 \column{0.65\textwidth}
 \textcolor{UltraViolet}{\textbf{Filtrar datos:}}\\
 \vspace{-0.2cm}
 \begin{verbatim}
Amci <- filter(A, dx == "MCI")
B <- Amci %>%
    select(MEMORY, LANGUAGE, EXECUTIVE, 
           VISUOSPATIAL, ORIENTATION, ATTENTION)
 \end{verbatim}
 \end{columns}
 la tabla B tiene 680 observaciones (filas) con 6 variables (columnas)
\end{frame}

\begin{frame}[fragile]{Agrupamiento de datos (Clustering)}
Conjunto de métodos \textbf{no-supervisados} para dividir un grupo de datos en sub-grupos de tal forma que:
\begin{itemize}
 \item Observaciones muy parecidas pertenecen a un mismo sub-grupo.
 \item Observaciones muy diferentes pertenecen a distintos sub-grupos.
\end{itemize}
\vspace{0.4cm}
\pause
Algunos de los métodos más conocidos:
 \begin{itemize}
  \item \textcolor<3>{PinkPeacock}{$k-$means} 
  \item $k-$medoids
  \item Hierarchical clustering
  %\item Density-Based Spatial Clustering of Applications with Noise (DBSCAN) 
 \end{itemize}
\end{frame}

\section{$k$-means}

{%
\setbeamertemplate{frame footer}{Artwork by @allison\_horst}
\setbeamercolor{background canvas}{bg=white}
\usebeamercolor[fg]{normal text}
\begin{frame}[fragile]{}
\vspace{-0.4cm}
\makebox[\linewidth]{%
\includegraphics<1>[width=\paperwidth]{imgs/allison_horst/kmeans_1.jpg}
\includegraphics<2>[width=\paperwidth]{imgs/allison_horst/kmeans_2.jpg}
\includegraphics<3>[width=\paperwidth]{imgs/allison_horst/kmeans_3.jpg}
\includegraphics<4>[width=\paperwidth]{imgs/allison_horst/kmeans_4.jpg}
\includegraphics<5>[width=\paperwidth]{imgs/allison_horst/kmeans_5.jpg}
\includegraphics<6>[width=\paperwidth]{imgs/allison_horst/kmeans_6.jpg}
\includegraphics<7>[width=\paperwidth]{imgs/allison_horst/kmeans_7.jpg}
\includegraphics<8>[width=\paperwidth]{imgs/allison_horst/kmeans_8.jpg}
\includegraphics<9>[width=\paperwidth]{imgs/allison_horst/kmeans_9.jpg}
\includegraphics<10>[width=\paperwidth]{imgs/allison_horst/kmeans_10.jpg}
\includegraphics<11>[width=\paperwidth]{imgs/allison_horst/kmeans_11.jpg}
\includegraphics<12>[width=\paperwidth]{imgs/allison_horst/kmeans_12.jpg}
}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Ejemplo $k$-means con $k=2$}}\\
\vspace{0.3cm}
En la librería \texttt{stats}, paquete base de R, tenemos la función \texttt{kmeans()}\\
\begin{columns}[t]
\column{0.25\textwidth}
\begin{verbatim} 
k <- 2
k2res <- kmeans(B, k)
str(k2res)
\end{verbatim}
\column{0.65\textwidth}
\begin{figure}
 \includegraphics[width=\textwidth]{imgs/str_k2res.png}
\end{figure}
\end{columns}
\pause
\vspace{0.2cm}
Los grupos asignados a las 680 observaciones están en \texttt{k2res\$cluster}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Ejemplo $k$-means con $k=3$}}\\
\vspace{0.3cm}
\begin{columns}[t]
\column{0.25\textwidth}
\begin{verbatim} 
k <- 3
k3res <- kmeans(B, k)
str(k3res)
\end{verbatim}
\column{0.65\textwidth}
\begin{figure}
 \includegraphics[width=\textwidth]{imgs/str_k3res.png}
\end{figure}
\end{columns}
\pause
\vspace{0.2cm}
Podemos comparar las dos particiones con \texttt{table(k2res\$cluster, k3res\$cluster)}. Los 3 sub-grupos no son necesariamente particiones de los 2 primeros sub-grupos.
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\setbeamertemplate{frame footer}{$^*$ Usando análisis de componentes principales (PCA)}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large ¿Cómo visualizar las particiones?}}\\
\vspace{0.3cm}
\begin{columns}[]
 \column{0.5\textwidth}
 La función \texttt{fviz\_cluster}, de la librería \texttt{factoextra}, grafica los datos en las $2$ direcciones de mayor varianza$^*$:\\
 \vspace{0.2cm}
 \begin{verbatim}
fviz_cluster(k2res, B, geom = "point")
fviz_cluster(k3res, B, geom = "point")
k4res <- kmeans(B, 4)
fviz_cluster(k4res, B, geom = "point")
...
\end{verbatim}
 \column{0.5\textwidth}
 \begin{figure}
   \includegraphics<1>[width=\textwidth]{imgs/fviz_k2res.png}
   \includegraphics<2>[width=\textwidth]{imgs/fviz_k3res.png}
   \includegraphics<3>[width=\textwidth]{imgs/fviz_k4res.png}
   \includegraphics<4>[width=\textwidth]{imgs/fviz_k5res.png}
 \end{figure}
\end{columns}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Importante:}} muchos (¿todos?) métodos de agrupamiento tienen inicialización aleatoria $\longrightarrow$ el resultado no siempre es el mismo.\\
\vspace{0.3cm}
\pause
\begin{columns}[]
 \column{0.45\textwidth}
 \vspace{0.2cm}
 \begin{verbatim}
> k <- 5
> set.seed(1987)
> res1 <- kmeans(B, k)
> set.seed(2020)
> res2 <- kmeans(B, k)
> table(res1$cluster, res2$cluster)
   
      1   2   3   4   5
  1  29   0   0   0 263
  2 116   0   1   2  19
  3  52   0   2  55   0
  4   0   1 100   0   0
  5   0  39   0   1   0
\end{verbatim}
 \column{0.55\textwidth}
 \begin{figure}
   \includegraphics<1>[width=\textwidth]{imgs/fviz_k5resA.png}
   \includegraphics<2>[width=\textwidth]{imgs/fviz_k5resB.png}
 \end{figure}
\end{columns}
\end{frame}
}

\section{¿Cómo elegir $k$?}

{\setbeamercolor{background canvas}{bg=white}
\setbeamertemplate{frame footer}{$^*$ En este caso, k-means con distancia euclideana, esta es la varianza intra-grupo}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large ¿Qué pasa cuando aumenta el número de sub-grupos?}}\vspace{0.5cm}
\begin{columns}[]
\column{0.5\textwidth}
 \begin{figure}
   \includegraphics<1>[width=\textwidth]{imgs/fviz_k2res.png}
   \includegraphics<2>[width=\textwidth]{imgs/fviz_k3res.png}
   \includegraphics<3>[width=\textwidth]{imgs/fviz_k4res.png}
   \includegraphics<4>[width=\textwidth]{imgs/fviz_k5res.png}
   \includegraphics<5>[width=\textwidth]{imgs/fviz_k6res.png}
   \includegraphics<6>[width=\textwidth]{imgs/fviz_k7res.png}
 \end{figure}
 \column{0.5\textwidth}
  Suma de los cuadrados de las distancias al centro del sub-grupo (\texttt{\$withinss}):\\
  \vspace{0.3cm}
  \begin{enumerate}[<+->]
  \addtocounter{enumi}{1}
   \item \texttt{\small 1081.833 1930.495}
   \item \texttt{\small 759.5350 762.2628 868.6328}
   \item \texttt{\small 347.6101 688.4191 390.6727 618.7741}
   \item \texttt{\small 390.9384 309.5926 277.6631 368.1043 514.1842}
   \item \texttt{\small 300.4036 398.3652 424.8112 189.4664 203.1081 247.0580}
   \item \texttt{\small 213.9738 358.3246 270.7691 173.4431 218.0087 174.3776 199.9581}
  \end{enumerate}
\end{columns}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\begin{align*}
 \mbox{Variabilidad total} &\geq \sum_{\mbox{\tiny sub-grupos}} \mbox{Variabilidad intra-grupo}\\
 \sum_{\mbox{\tiny observaciones}} (\mbox{distancia al centro del grupo})^2 &\geq \sum_{\mbox{\tiny sub-grupos}} \sum_{\substack{\mbox{\tiny observaciones}\\\mbox{\tiny en sub-grupo}}} (\mbox{distancia al centro del sub-grupo})^2\\
 \mbox{\texttt{\$totss}} &\geq \mbox{\texttt{\$tot.withinss}}
\end{align*}
\pause
\vspace{-0.4cm}
\begin{columns}
 \column{0.3\textwidth}
 \begin{center}
  \textcolor{UltraViolet}{\textbf{\large Método del codo}}\\
  (Elbow method)\\
  \vspace{0.3cm}
  \onslide<3->{meh!}
 \end{center}
 \column{0.7\textwidth}
 \begin{figure}
 \includegraphics[width=\textwidth]{imgs/wcss.png}
\end{figure}
\end{columns}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
Esta gráfica también la podemos generar con la función \texttt{fviz\_nbclust}:\\
\begin{verbatim}
fviz_nbclust(B, kmeans, method = "wss")
\end{verbatim}
\pause
\begin{figure}
 \includegraphics[width=0.8\textwidth]{imgs/fviz_wss.png}
\end{figure}
\pause
\vspace{-0.2cm}
¿Dónde se ve un codo?
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Método de la silueta:}} basado en que tan lejos (o cerca) están las observaciones a los sub-grupos vecinos.
\begin{verbatim}
fviz_nbclust(B, kmeans, method = "silhouette")
\end{verbatim}
\pause
\begin{figure}
 \includegraphics[width=0.75\textwidth]{imgs/fviz_silueta.png}
\end{figure}
\pause
\vspace{-0.2cm}
Número sugerido de sub-grupos: 2
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Método del \textit{gap statistic}:}} Compara las varianzas intra-grupo observadas Vs. varianzas intra-grupo simuladas.
\begin{verbatim}
fviz_nbclust(B, kmeans, method = "gap_stat")
\end{verbatim}
\pause
\begin{figure}
 \includegraphics[width=0.75\textwidth]{imgs/fviz_gap.png}
\end{figure}
\pause
\vspace{-0.2cm}
Número sugerido de sub-grupos: 3
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
Hay \textcolor{UltraViolet}{\textbf{\large $\pm$ TREINTA}} índices/criterios diferentes:
\begin{verbatim}
NbClust(data = B, method = "kmeans")
\end{verbatim}
\pause
\begin{figure}
 \includegraphics[width=0.75\textwidth]{imgs/nbclust.png}
\end{figure}
\pause
\vspace{-0.2cm}
Número de sub-grupos sugerido por la mayoría: 3
\end{frame}
}

\begin{frame}[plain]
\vspace{1cm}
\begin{columns}
 \column{0.4\textwidth}
 \begin{center}
  \vspace{-3cm}
  \textbf{\Huge{Ajá,\\
  \vspace{0.5cm}
  y entonces?}}\\
  \vspace{1cm}
  \onslide<2->{Usar el criterio propio para tomar una \textit{decisión informada}}
 \end{center}
 \column{0.1\textwidth}
 \column{0.5\textwidth}
 \includegraphics[width=\textwidth]{../../Documents/proposal-defense/img/me_questionmark.png}
\end{columns}
\end{frame}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Resultado con $k=3$}} 
\begin{columns}
 \column{0.45\textwidth}
{\small
 \begin{verbatim}
res <- kmeans(B, 3)
Amci$k3 <- as.factor(res$cluster)
nd <- colnames(B)
m <- melt(Amci, measure.vars = nd)
ggplot(m, aes(k3, value)) + 
    geom_boxplot(aes(colour = variable)) + 
    theme(legend.position = "top")
\end{verbatim}}
 \column{0.55\textwidth}
 \pause
 \begin{figure}
 \includegraphics[width=\textwidth]{imgs/boxplots3.png}
\end{figure}
\end{columns}
\end{frame}
}

\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Hasta ahora...}}\\
\vspace{0.3cm}
Hemos usado \textbf{$k$-means} y hemos asumido que la distancia entre observaciones es la \textbf{distancia euclideana} (por defecto).\\
\vspace{0.4cm}
\pause
\textcolor{PinkPeacock}{Sobre $k$-means}:
\begin{itemize}
 \item Como la media, es sensible a \textit{outliers}
 \item Los centros de cada sub-grupo no estan necesariamente en el conjunto de observaciones.
 \item Es necesario conocer el espacio donde están las observaciones. 
\end{itemize}
\vspace{0.4cm}
\pause
\textcolor{HawaianSurf}{Sobre la distancia euclideana}:
\begin{itemize}
 \item Se asume ortogonalidad entre dimensiones ($\longrightarrow$ independencia?)
 \item Todaslas dimensiones tienen la misma importancia.
 \item Cosas raras empiezan a pasar en espacios de muchas dimensiones.
\end{itemize}
\end{frame}

\section{Distancias entre observaciones}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
Las funciones \texttt{dist} y \texttt{get\_dist} permiten calcular diferentes distancias entre observaciones. 
\begin{columns}
\column{0.5\textwidth}
\begin{verbatim}
tmp_B <- B[sample(1:nrow(B), 100),]
\end{verbatim}
\textcolor{UltraViolet}{Euclideana $(L^2)$}:\\
\texttt{dist(tmp\_B, method = "euclidean")}\\
\vspace{0.1cm}
\onslide<2->{%
\textcolor{UltraViolet}{Manhattan $(L^1)$}:\\
\texttt{dist(tmp\_B, method = "manhattan")}\\\vspace{0.1cm}}
\onslide<3->{%
\textcolor{UltraViolet}{Maximo $(L^\infty)$}:\\
\texttt{dist(tmp\_B, method = "maximum")}\\\vspace{0.1cm}}
\onslide<4->{%
\textcolor{UltraViolet}{Binaria $(L^0)$}:\\
\texttt{dist(tmp\_B, method = "binary")}\\\vspace{0.1cm}}
\column{0.45\textwidth}
\texttt{fviz\_dist(d, show\_labels = FALSE)}
\begin{figure}
 \includegraphics<1>[width=\textwidth]{imgs/ex_euclid.png}
 \includegraphics<2>[width=\textwidth]{imgs/ex_manhattan.png}
 \includegraphics<3>[width=\textwidth]{imgs/ex_maxi.png}
 \includegraphics<4>[width=\textwidth]{imgs/ex_binary.png}
\end{figure}
\end{columns}
\end{frame}
}

\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{HawaianSurf}{\textbf{\large De regreso a nuestros datos...}}\\
\vspace{0.3cm}
Tenemos los puntajes en 6 dominios cognitivos: memoria, lenguaje, función ejecutiva, habilidades visuoespaciales, orientación y atención.\\
\vspace{0.2cm}
\pause
Estas variables \textbf{NO} son independientes!\\
\vspace{0.4cm}
\pause
\textcolor{UltraViolet}{Distancia de Mahalanobis}: tiene en cuenta las correlaciones entre variables, reduce la redundancia.
\[d_M(i,j)^2 = (x_i - x_j)^TC^{-1}(x_i - x_j)\]
$C$: matriz de covarianza.\\
\vspace{0.8cm}
\pause
\setbeamercolor{greybox}{bg=LightGrey}
\begin{beamercolorbox}[sep=2mm]{greybox}
En R, la función \texttt{mahalanobis()} calcula la distancia de uno o varios puntos al centro de una distribución, no calcula la distancia entre pares de puntos.
\end{beamercolorbox}
\end{frame}

\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Distancia de Mahalanobis hecha a mano}}\\
\vspace{0.3cm}
\begin{verbatim}
my_mah_dist <- function(M, invcov){
    n <- nrow(M)
    d_mah <-  matrix(data = NA, nrow = n, ncol = n)
    for (i in 1:n){
        for (j in 1:i){
            x <- as.matrix(M[i,] - M[j,])
            d_mah[i,j] <- x %*% invcov %*% t(x)
        }
    }
    d <- as.dist(sqrt(d_mah))
    return(d)
}

d <- my_mah_dist(tmp_B, solve(cov(B)))
\end{verbatim}
\end{frame}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
~\\
\vspace{0.4cm}
\begin{columns}
\column{0.5\textwidth}
 \textcolor{UltraViolet}{Distancia de Mahalanobis}
 \begin{figure}
 \includegraphics[width=\textwidth]{imgs/ex_mah.png}
 \end{figure}
\column{0.5\textwidth}
 \textcolor{UltraViolet}{Distancia euclideana}
 \begin{figure}
 \includegraphics[width=\textwidth]{imgs/ex_euclid.png}
 \end{figure}
\end{columns}
\pause 
El agrupamiento de datos depende completamente de la distancia!
\end{frame}
}

\section{$k$-medoids}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
Necesitamos un método de agrupamiento que acepte nuestra propia distancia: \alert{$k$-medoids}\\
\vspace{0.3cm}
\pause
La función \texttt{pam()} de la librería \texttt{cluster} es una implementación de $k$-medoids o \textit{Partition Around Medoids (PAM)}\pause
\begin{columns}
 \column{0.65\textwidth}
 \begin{verbatim}
> d <- my_mah_dist(B, solve(cov(B)))
> k <- 3
> pamres <- pam(d, k, diss = TRUE, pamonce = 5)
> table(pamres$clustering, res$cluster)
   
      1   2   3
  1 160   6  48
  2 203  26  27
  3  24 144  42
\end{verbatim}
\column{0.25\textwidth}
\texttt{res\$cluster}: partición con $k$-means y distancia euclideana.
\end{columns}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
Revisemos los criterios para elegir $k$\\
\vspace{0.3cm}
\textcolor{UltraViolet}{Método del codo:}
\begin{verbatim}
fviz_nbclust(B, FUNcluster = pam, method = "wss", diss = d) 
\end{verbatim}
\pause
\begin{figure}
 \includegraphics[width=0.8\textwidth]{imgs/pammah_fviz_wss.png}
\end{figure}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
Revisemos los criterios para elegir $k$\\
\vspace{0.3cm}
\textcolor{UltraViolet}{Método de la silueta:}
\begin{verbatim}
fviz_nbclust(B, FUNcluster = pam, method = "silhouette", diss = d)
\end{verbatim}
\begin{figure}
 \includegraphics[width=0.8\textwidth]{imgs/pammah_fviz_sil.png}
\end{figure}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
Revisemos los criterios para elegir $k$\\
\vspace{0.3cm}
\textcolor{UltraViolet}{Método del \textit{gap statistic}:}
\begin{verbatim}
fviz_nbclust(B, FUNcluster = pam, method = "gap", diss = d)
\end{verbatim}
\begin{figure}
 \includegraphics[width=0.8\textwidth]{imgs/pammah_fviz_silgap.png}
\end{figure}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
Y la votación de los otros treinta índices:
\begin{verbatim}
NbClust(data = B, diss = d, distance = NULL, method = "ward.D2")
\end{verbatim}
\begin{figure}
 \includegraphics[width=0.75\textwidth]{imgs/mah_nbclust.png}
\end{figure}
\pause
\vspace{-0.2cm}
\end{frame}
}

{\setbeamercolor{background canvas}{bg=white}
\begin{frame}[fragile]{}
\vspace{0.3cm}
\textcolor{UltraViolet}{\textbf{\large Comparación de resultados}}\\
\vspace{0.3cm}
\begin{columns}
 \column{0.45\textwidth}
 \begin{center}
  \begin{figure}
  \includegraphics[width=\textwidth]{imgs/boxplots3.png}
 \end{figure}
 1: 387, 2: 176, 3: 117\\ 
 $k-$means, distancia euclideana
 \end{center}
 \column{0.45\textwidth}
 \begin{center}
  \begin{figure}
  \includegraphics[width=\textwidth]{imgs/boxplots_pam3.png}
 \end{figure}
 1: 214, 2: 256, 3: 210\\ 
 PAM, distancia de Mahalanobis
 \end{center}
\end{columns}

\end{frame}
}

%%% BYE

{
\usebackgroundtemplate{\includegraphics[width=\paperwidth]{../../Documents/weekly-seminar/img/purple_wall.jpg}}
\begin{frame}[plain]
\begin{overlayarea}{0.9\textwidth}{9cm}
 \begin{columns}
 \column{0.5\textwidth}
  \begin{tikzpicture}[remember picture,overlay]
    \node[xshift=4.5cm,yshift=4.5cm] at (current page.south west) {\includegraphics[width=1.3\textwidth]{../../Documents/weekly-seminar/img/me_letsdiscuss.png}};
  \end{tikzpicture}
  \column{0.1\textwidth}
  \column{0.35\textwidth}
  \vspace{6cm}
\setbeamercolor{whitebox}{bg=white}
\begin{beamercolorbox}[sep=2mm]{whitebox}
 \textbf{\Huge Gracias!}\\
 \vspace{0.2cm}
 dia.giraldo@gmail.com
\end{beamercolorbox}
 \end{columns}
\end{overlayarea}
\end{frame}
}

\end{document}
